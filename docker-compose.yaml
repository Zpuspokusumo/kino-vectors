version: "3.9"

services:
  qdrant:
    image: qdrant/qdrant:v1.15.4
    container_name: qdrant
    ports:
      - "6333:6333"
    volumes:
      - qdrant_data:/qdrant/storage

  embedding-service:
    build:
      context: ./embedding-service
      dockerfile: Dockerfile
    container_name: embedding-service
    depends_on:
      - qdrant
    environment:
      - QDRANT_URL=http://qdrant:6333
      - MODEL_PATH=/models/onnx/model.onnx
    volumes:
      - models_data:/models
    command: ["/bin/sh", "-c", "/app/scripts/fetch_model.sh && ./embeddings"]
    ports:
      - "1555:1555"

  web-service:
    build:
      context: ./web-service
      dockerfile: Dockerfile
    container_name: web-service
    depends_on:
      - embedding-service
    environment:
      - EMBEDDING_GRPC=embedding-service:1555
      - PORT=5821
    ports:
      - "5821:5821"

volumes:
  qdrant_data:
  models_data:
